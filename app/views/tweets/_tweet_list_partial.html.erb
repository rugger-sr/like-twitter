<%
  options = {
    user_id: nil,
    offset: 0,
  }
  options[:user_id] = user.id if user.present?
%>

<ul class="tweets">
  <%= render partial: 'tweets/loading', locals: { options: options } %>
</ul>

<%= javascript_tag do %>
  $(function() {
    $('.tweets').on('inview', '#loading-line', function(event, isInView) {
      if (isInView) {
        var loading = $(this)
        setTimeout(
          function() {
            var params = {
              user_id: loading.data('user'),
              time: loading.data('time'),
              offset: loading.data('offset')
            }

            $.get("<%= search_path %>",
              params,
              function(data){
                var parent = loading.parent();
                loading.remove();
                parent.append(data)
              }
            );
          },0
        );
      }
    });
  });
<% end %>
